app-id: com.github.KCC
runtime: org.kde.Platform
runtime-version: '5.15'
sdk: org.kde.Sdk
command: kcc
finish-args:
  - --socket=fallback-x11
  - --share=ipc
  - --share=network
  - --filesystem=host
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
modules:
  - name: p7zip
    no-autogen: true
    make-args:
      - 7z
    sources:
      - type: archive
        url: https://sourceforge.net/projects/p7zip/files/p7zip/16.02/p7zip_16.02_src_all.tar.bz2
        sha256: 5eb20ac0e2944f6cb9c2d51dd6c4518941c185347d4089ea89087ffdd6e2341f
      - type: shell
        commands: 
        - sed -i 's|/usr/local|/app|g' makefile.common
      - type: patch
        path: patches/p7zip-gcc10.patch
      - type: patch
        path: patches/p7zip-norar.patch
      - type: patch
        path: patches/p7zip-CVE-2016-9296.patch
      - type: patch
        path: patches/p7zip-CVE-2017-17969.patch
      - type: patch
        path: patches/p7zip-CVE-2018-5996.patch
      - type: patch
        path: patches/p7zip-CVE-2018-10115.patch
  - name: pyqt5
    buildsystem: simple
    build-commands:
      - . ${FLATPAK_BUILDER_BUILDDIR}/build
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/source/p/pyqt5/PyQt5-5.15.2.tar.gz
        sha256: 372b08dc9321d1201e4690182697c5e7ffb2e0770e6b4a45519025134b12e4fc
      - type: file
        path: pyqt-build
        dest-filename: build
    cleanup:
      - /bin
    modules:
      - pyqt5-pypi-dependencies.json
  - name: KindleComicConverter
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST}
      - install -Dm755 ${FLATPAK_ID}.desktop -t /app/share/applications
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml -t /app/share/metainfo
      - mkdir -p /app/share/icons && cp -r hicolor /app/share/icons
    sources:
      - type: archive
        url: https://github.com/ciromattia/kcc/archive/5.5.2.tar.gz
        sha256: 7b45fcdf0149bea36e8c738e76031790c8c235c777047001279698a526be892b 
      - type: file
        path: com.github.KCC.desktop
      - type: dir
        path: icons
      - type: file
        path: com.github.KCC.metainfo.xml
    modules:
      - kcc-pypi-dependencies.json
